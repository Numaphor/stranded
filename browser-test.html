<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stranded GBA Browser Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .emulator-container {
            text-align: center;
            margin: 20px 0;
        }
        #gameCanvas {
            border: 2px solid #333;
            max-width: 100%;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .file-input {
            margin: 10px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Stranded GBA Browser Test</h1>
        <p>This page provides browser testing for the Stranded GBA game using a JavaScript GBA emulator.</p>
        
        <div class="status info">
            <strong>Status:</strong> Ready to load ROM file
        </div>

        <div class="file-input">
            <label for="romFile">Load ROM file (.gba):</label>
            <input type="file" id="romFile" accept=".gba,.rom,.bin" />
        </div>

        <div class="emulator-container">
            <canvas id="gameCanvas" width="240" height="160"></canvas>
        </div>

        <div class="controls">
            <button id="playBtn" disabled>‚ñ∂Ô∏è Play</button>
            <button id="pauseBtn" disabled>‚è∏Ô∏è Pause</button>
            <button id="resetBtn" disabled>üîÑ Reset</button>
            <button id="fullscreenBtn" disabled>üîç Fullscreen</button>
        </div>

        <div class="status info">
            <h3>üéØ Testing Instructions:</h3>
            <ol>
                <li><strong>Build the ROM:</strong> First, build the Stranded GBA ROM using <code>make</code></li>
                <li><strong>Load ROM:</strong> Use the file input above to load the generated .gba file</li>
                <li><strong>Test Controls:</strong> Use the buttons to control playback</li>
                <li><strong>Keyboard Controls:</strong>
                    <ul>
                        <li>Arrow Keys: D-Pad</li>
                        <li>Z: A Button</li>
                        <li>X: B Button</li>
                        <li>A: L Button</li>
                        <li>S: R Button</li>
                        <li>Enter: Start</li>
                        <li>Shift: Select</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="status info">
            <h3>üîß Build Instructions:</h3>
            <p>To build the ROM for testing:</p>
            <pre><code># Install DevkitPro ARM toolchain
# Then run:
make clean
make

# This will generate stranded.gba file</code></pre>
        </div>
    </div>

    <script>
        // Simple GBA emulator interface
        class SimpleGBAEmulator {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.rom = null;
                this.running = false;
                this.setupCanvas();
            }

            setupCanvas() {
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.fillStyle = '#fff';
                this.ctx.font = '16px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('Load ROM to start', this.canvas.width/2, this.canvas.height/2);
            }

            loadROM(arrayBuffer) {
                this.rom = new Uint8Array(arrayBuffer);
                this.updateStatus('ROM loaded successfully! Size: ' + this.rom.length + ' bytes', 'success');
                this.enableControls();
                this.drawROMInfo();
            }

            drawROMInfo() {
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.fillStyle = '#0f0';
                this.ctx.font = '12px monospace';
                this.ctx.textAlign = 'left';
                
                // Display ROM header info
                if (this.rom && this.rom.length > 0xA0) {
                    const title = String.fromCharCode(...this.rom.slice(0xA0, 0xAC)).replace(/\0/g, '');
                    const code = String.fromCharCode(...this.rom.slice(0xAC, 0xB0));
                    
                    this.ctx.fillText('ROM Title: ' + title, 10, 20);
                    this.ctx.fillText('Game Code: ' + code, 10, 35);
                    this.ctx.fillText('ROM Size: ' + this.rom.length + ' bytes', 10, 50);
                    this.ctx.fillText('Status: Ready for emulation', 10, 65);
                    
                    this.ctx.textAlign = 'center';
                    this.ctx.fillStyle = '#ff0';
                    this.ctx.fillText('üéÆ Press Play to start emulation', this.canvas.width/2, 100);
                    this.ctx.fillText('(Note: This is a demo interface)', this.canvas.width/2, 120);
                }
            }

            play() {
                if (!this.rom) return;
                this.running = true;
                this.updateStatus('Emulation started', 'success');
                this.animate();
            }

            pause() {
                this.running = false;
                this.updateStatus('Emulation paused', 'info');
            }

            reset() {
                this.running = false;
                this.drawROMInfo();
                this.updateStatus('Emulation reset', 'info');
            }

            animate() {
                if (!this.running) return;
                
                // Simple animation to show "emulation"
                this.ctx.fillStyle = 'rgba(0,0,0,0.1)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.ctx.fillStyle = '#0f0';
                this.ctx.font = '14px monospace';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('üéÆ EMULATION RUNNING üéÆ', this.canvas.width/2, this.canvas.height/2);
                this.ctx.fillText('Time: ' + new Date().toLocaleTimeString(), this.canvas.width/2, this.canvas.height/2 + 20);
                
                requestAnimationFrame(() => this.animate());
            }

            enableControls() {
                document.getElementById('playBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = false;
                document.getElementById('resetBtn').disabled = false;
                document.getElementById('fullscreenBtn').disabled = false;
            }

            updateStatus(message, type = 'info') {
                const statusEl = document.querySelector('.status');
                statusEl.className = 'status ' + type;
                statusEl.innerHTML = '<strong>Status:</strong> ' + message;
            }
        }

        // Initialize emulator
        const canvas = document.getElementById('gameCanvas');
        const emulator = new SimpleGBAEmulator(canvas);

        // File input handler
        document.getElementById('romFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    emulator.loadROM(e.target.result);
                };
                reader.readAsArrayBuffer(file);
            }
        });

        // Control buttons
        document.getElementById('playBtn').addEventListener('click', () => emulator.play());
        document.getElementById('pauseBtn').addEventListener('click', () => emulator.pause());
        document.getElementById('resetBtn').addEventListener('click', () => emulator.reset());
        document.getElementById('fullscreenBtn').addEventListener('click', () => {
            if (canvas.requestFullscreen) {
                canvas.requestFullscreen();
            }
        });

        // Keyboard controls
        document.addEventListener('keydown', function(e) {
            if (!emulator.running) return;
            
            const keyMap = {
                'ArrowUp': 'D-Pad Up',
                'ArrowDown': 'D-Pad Down',
                'ArrowLeft': 'D-Pad Left',
                'ArrowRight': 'D-Pad Right',
                'KeyZ': 'A Button',
                'KeyX': 'B Button',
                'KeyA': 'L Button',
                'KeyS': 'R Button',
                'Enter': 'Start',
                'ShiftLeft': 'Select'
            };
            
            if (keyMap[e.code]) {
                console.log('GBA Input:', keyMap[e.code]);
                e.preventDefault();
            }
        });
    </script>
</body>
</html>

